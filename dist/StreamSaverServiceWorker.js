"use strict";function generateDownloadUrl(e){return self.registration.scope+"/"+e}var downloads={};this.addEventListener("fetch",function(e){var n=e.request.url,o=downloads[n];if(!o)return null;var t={"Content-Disposition":"attachment; filename*=UTF-8''"+o.fileInfo.name};o.fileInfo.contentType&&(t["Content-Type"]=o.fileInfo.contentType),o.fileInfo.size&&(t["Content-Length"]=o.fileInfo.size),e.respondWith(new Response(o.stream,{headers:t})),delete downloads[n]}),self.onmessage=function(e){if(!e.ports[0]||!e.ports[0]instanceof MessagePort)return console.error("Worker recieved message without MessagePort provided");var n=e.ports[0],o=JSON.parse(e.data),t=generateDownloadUrl(o.name),s=new ReadableStream({start:function(e){console.log("writer starting, controller:",e),n.onmessage=function(o){var t=o.data;if(t instanceof ArrayBuffer){var s=new Uint8Array(t);e.enqueue(s),n.postMessage("chunk added")}else t instanceof Uint8Array?(e.enqueue(t),n.postMessage("chunk added")):"close"==t?e.close():"abort"==t&&e.abort()}},cancel:function(){console.log("aborted")}});downloads[t]={downloadUrl:t,fileInfo:o,messagePort:n,stream:s},n.postMessage(t)};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN0cmVhbVNhdmVyU2VydmljZVdvcmtlci5qcyJdLCJuYW1lcyI6WyJnZW5lcmF0ZURvd25sb2FkVXJsIiwiZmlsZU5hbWUiLCJzZWxmIiwiZG93bmxvYWRzIiwidGhpcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInVybCIsInJlcXVlc3QiLCJkb3dubG9hZERhdGEiLCJoZWFkZXJzIiwiQ29udGVudC1EaXNwb3NpdGlvbiIsImZpbGVJbmZvIiwibmFtZSIsImNvbnRlbnRUeXBlIiwic2l6ZSIsInJlc3BvbmRXaXRoIiwiUmVzcG9uc2UiLCJzdHJlYW0iLCJvbm1lc3NhZ2UiLCJwb3J0cyIsIk1lc3NhZ2VQb3J0IiwiY29uc29sZSIsImVycm9yIiwicGFyc2UiLCJkYXRhIiwiZG93bmxvYWRVcmwiLCJSZWFkYWJsZVN0cmVhbSIsIm1lc3NhZ2VQb3J0IiwiY29udHJvbGxlciIsIl9yZWYiLCJBcnJheUJ1ZmZlciIsInVuaXRBcnJheSIsImVucXVldWUiLCJVaW50OEFycmF5IiwicG9zdE1lc3NhZ2UiLCJjYW5jZWwiLCJsb2ciXSwibWFwcGluZ3MiOiJBQUFBLGFBZ0VBLFNBQVNBLG9CQUFvQkMsR0FBN0IsT0FBQUMsS0FBU0YsYUFBQUEsTUFBb0JDLElBQVVBLEVBOUR2QyxJQUFJRSxhQUVKQyxLQUFLQyxpQkFBaUIsUUFBUyxTQUFBQyxHQUM5QixJQUFNQyxFQUFNRCxFQUFNRSxRQUFRRCxJQUVqQkUsRUFBZU4sVUFBckJJLEdBQ0gsSUFBS0UsRUFBYyxPQUFPLEtBRXZCLElBQ0dDLEdBQ0xDLHNCQUF1QixnQ0FGSkYsRUFBYUcsU0FBOUJDLE1BS0NKLEVBQWFHLFNBQVNFLGNBQWFKLEVBQVEsZ0JBQWtCRCxFQUFhRyxTQUFTRSxhQUNuRkwsRUFBYUcsU0FBU0csT0FBTUwsRUFBUSxrQkFBb0JELEVBQWFHLFNBQVNHLE1BRWxGVCxFQUFNVSxZQUFZLElBQUlDLFNBQVNSLEVBQWFTLFFBQVVSLFFBQUFBLFlBRy9DUCxVQUFVSSxLQUdsQkwsS0FBS2lCLFVBQVksU0FBQWIsR0FDaEIsSUFBS0EsRUFBTWMsTUFBTSxLQUFPZCxFQUFNYyxNQUFNLGFBQWNDLFlBQ2pELE9BQU9DLFFBQVFDLE1BQU0sd0RBR3RCLElBQU1YLEVBQWdCWSxFQUFNbEIsTUFBTW1CLEdBQzVCQyxFQUFBQSxLQUFjMUIsTUFBQUEsRUFBQUEsTUFDZGtCLEVBQWFTLG9CQUFlZixFQUFBQyxNQUFBSyxFQUFBLElBQUFTLGdCQUVoQ0wsTUFGZ0MsU0FFaENBLEdBQ0FNLFFBQUFBLElBQVlULCtCQUF3QlUsR0FBQUQsRUFBQVQsVUFBQSxTQUFBVyxHQUFBLElBQUFMLEVBQUFLLEVBQUFMLEtBQ25DLEdBQUlBLGFBQWdCTSxZQUFhLENBQWpDLElBQUlOLEVBQUFBLElBQWdCTSxXQUFhTixHQUNoQ0ksRUFBTUcsUUFBWUEsR0FDbEJILEVBQVdJLFlBQVFELG9CQUNuQkosYUFBd0JNLFlBSHpCTCxFQUlXSixRQUFBQSxHQUNWSSxFQUFXSSxZQUFYLGdCQUNZRSxTQUFaUCxFQUZNQyxFQUdJSixRQUNWLFNBQUFJLEdBRE1BLEVBRUlKLFVBSVpXLE9BakJnQyxXQWtCakNBLFFBbEJpQ0MsSUFBQSxjQXVCbENsQyxVQUFVdUIsSUFBVnZCLFlBQUFBLEVBQ0N1QixTQUFBQSxFQUNBZCxZQUFBQSxFQUNBZ0IsT0FBQUEsR0FJREEsRUFBWU8sWUFBWVQiLCJmaWxlIjoiU3RyZWFtU2F2ZXJTZXJ2aWNlV29ya2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5sZXQgZG93bmxvYWRzID0ge307XG5cbnRoaXMuYWRkRXZlbnRMaXN0ZW5lcignZmV0Y2gnLCAoZXZlbnQpID0+IHtcblx0Y29uc3QgdXJsID0gZXZlbnQucmVxdWVzdC51cmw7XG5cbiAgICBjb25zdCBkb3dubG9hZERhdGEgPSBkb3dubG9hZHNbdXJsXTtcblx0aWYgKCFkb3dubG9hZERhdGEpIHJldHVybiBudWxsO1xuXG4gICAgY29uc3QgZmlsZW5hbWUgPSBkb3dubG9hZERhdGEuZmlsZUluZm8ubmFtZTtcblx0Y29uc3QgaGVhZGVycyA9IHtcblx0XHQnQ29udGVudC1EaXNwb3NpdGlvbic6IFwiYXR0YWNobWVudDsgZmlsZW5hbWUqPVVURi04JydcIiArIGZpbGVuYW1lXG5cdH1cblx0XG5cdGlmIChkb3dubG9hZERhdGEuZmlsZUluZm8uY29udGVudFR5cGUpIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gZG93bmxvYWREYXRhLmZpbGVJbmZvLmNvbnRlbnRUeXBlO1xuXHRpZiAoZG93bmxvYWREYXRhLmZpbGVJbmZvLnNpemUpIGhlYWRlcnNbJ0NvbnRlbnQtTGVuZ3RoJ10gPSBkb3dubG9hZERhdGEuZmlsZUluZm8uc2l6ZTtcblxuXHRldmVudC5yZXNwb25kV2l0aChuZXcgUmVzcG9uc2UoZG93bmxvYWREYXRhLnN0cmVhbSwgeyBoZWFkZXJzIH0pKTtcblxuXHQvLyBkZWxldGUgdGhlIGRvd25sb2FkcyB2YXJpYWJsZSBhcyB3ZSBvbmx5IHN1cHBvcnQgMSBzdHJlYW0gPSAxIGRvd25sb2FkXG5cdGRlbGV0ZSBkb3dubG9hZHNbdXJsXTtcbn0pO1xuXG5zZWxmLm9ubWVzc2FnZSA9IGV2ZW50ID0+IHtcblx0aWYgKCFldmVudC5wb3J0c1swXSB8fCAhZXZlbnQucG9ydHNbMF0gaW5zdGFuY2VvZiBNZXNzYWdlUG9ydCkgXG5cdFx0cmV0dXJuIGNvbnNvbGUuZXJyb3IoXCJXb3JrZXIgcmVjaWV2ZWQgbWVzc2FnZSB3aXRob3V0IE1lc3NhZ2VQb3J0IHByb3ZpZGVkXCIpO1xuXHRcdFxuXHRjb25zdCBtZXNzYWdlUG9ydCA9IGV2ZW50LnBvcnRzWzBdO1xuXHRjb25zdCBmaWxlSW5mbyA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XG5cdGNvbnN0IGRvd25sb2FkVXJsID0gZ2VuZXJhdGVEb3dubG9hZFVybChmaWxlSW5mby5uYW1lKTtcblx0Y29uc3Qgc3RyZWFtID0gbmV3IFJlYWRhYmxlU3RyZWFtKHtcblx0XHRzdGFydChjb250cm9sbGVyKSB7XG5cdFx0XHRjb25zb2xlLmxvZyhcIndyaXRlciBzdGFydGluZywgY29udHJvbGxlcjpcIiwgY29udHJvbGxlcik7XG5cdFx0XHRtZXNzYWdlUG9ydC5vbm1lc3NhZ2UgPSAoe2RhdGF9KSA9PiB7XG5cdFx0XHRcdGlmIChkYXRhIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHtcblx0XHRcdFx0XHRjb25zdCB1bml0QXJyYXkgPSBuZXcgVWludDhBcnJheShkYXRhKTtcblx0XHRcdFx0XHRjb250cm9sbGVyLmVucXVldWUodW5pdEFycmF5KTtcblx0XHRcdFx0XHRtZXNzYWdlUG9ydC5wb3N0TWVzc2FnZShcImNodW5rIGFkZGVkXCIpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKGRhdGEgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG5cdFx0XHRcdFx0Y29udHJvbGxlci5lbnF1ZXVlKGRhdGEpO1xuXHRcdFx0XHRcdG1lc3NhZ2VQb3J0LnBvc3RNZXNzYWdlKFwiY2h1bmsgYWRkZWRcIik7XG5cdFx0XHRcdH0gZWxzZSBpZiAoZGF0YSA9PSBcImNsb3NlXCIpIHtcblx0XHRcdFx0XHRjb250cm9sbGVyLmNsb3NlKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoZGF0YSA9PSBcImFib3J0XCIpIHtcblx0XHRcdFx0XHRjb250cm9sbGVyLmFib3J0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cdFx0fSxcblx0XHRjYW5jZWwoKSB7XG5cdFx0XHRjb25zb2xlLmxvZyhcImFib3J0ZWRcIilcblx0XHR9XG5cdH0pO1xuXG5cdGRvd25sb2Fkc1tkb3dubG9hZFVybF0gPSB7XG5cdFx0ZG93bmxvYWRVcmwsXG5cdFx0ZmlsZUluZm8sXG5cdFx0bWVzc2FnZVBvcnQsXG5cdFx0c3RyZWFtXG5cdH07XG5cblx0bWVzc2FnZVBvcnQucG9zdE1lc3NhZ2UoZG93bmxvYWRVcmwpO1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZURvd25sb2FkVXJsKGZpbGVOYW1lKSB7XG5cdHJldHVybiBzZWxmLnJlZ2lzdHJhdGlvbi5zY29wZSArIFwiL1wiICsgZmlsZU5hbWU7XG59XG4iXX0=
