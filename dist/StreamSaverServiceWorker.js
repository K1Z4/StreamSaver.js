"use strict";function generateDownloadUrl(e){return self.registration.scope+"/"+e}var downloads={};this.addEventListener("fetch",function(e){var n=e.request.url,o=downloads[n];if(!o)return null;var t={"Content-Disposition":"attachment; filename*=UTF-8''"+o.fileInfo.name};o.fileInfo.contentType&&(t["Content-Type"]=o.fileInfo.contentType),o.fileInfo.size&&(t["Content-Length"]=o.fileInfo.size),e.respondWith(new Response(o.stream,{headers:t})),delete downloads[n]}),self.onmessage=function(e){if(!e.ports[0]||!e.ports[0]instanceof MessagePort)return console.error("Worker recieved message without MessagePort provided");var n=e.ports[0],o=JSON.parse(e.data),t=generateDownloadUrl(o.name),s=new ReadableStream({start:function(e){console.log("writer starting, controller:",e),n.onmessage=function(o){var t=o.data;if(t instanceof ArrayBuffer){var s=new Uint8Array(t);e.enqueue(s),n.postMessage("chunk added")}else t instanceof Uint8Array?(e.enqueue(t),n.postMessage("chunk added")):"close"==t?e.close():"abort"==t&&e.abort()}},cancel:function(){console.log("aborted")}});downloads[t]={downloadUrl:t,fileInfo:o,messagePort:n,stream:s},n.postMessage(t)};