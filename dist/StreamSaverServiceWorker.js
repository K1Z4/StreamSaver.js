"use strict";function generateDownloadUrl(e){return encodeURI(self.registration.scope+"/"+e)}function encodeRFC5987(e){return encodeURIComponent(e).replace(/['()]/g,function(e){return"%"+e.charCodeAt(0).toString(16)}).replace(/\*/g,"%2A")}var downloads={};this.addEventListener("fetch",function(e){var n=e.request.url,o=downloads[n];if(!o)return null;var t={"Content-Disposition":"attachment; filename*=UTF-8''"+encodeRFC5987(o.fileInfo.name)};o.fileInfo.contentType&&(t["Content-Type"]=o.fileInfo.contentType),o.fileInfo.size&&(t["Content-Length"]=o.fileInfo.size),e.respondWith(new Response(o.stream,{headers:t})),delete downloads[n]}),self.onmessage=function(e){if(!e.ports[0]||!e.ports[0]instanceof MessagePort)return console.error("Worker recieved message without MessagePort provided");var n=e.ports[0],o=JSON.parse(e.data),t=generateDownloadUrl(o.name),r=new ReadableStream({start:function(e){n.onmessage=function(o){var t=o.data;if(t instanceof ArrayBuffer){var r=new Uint8Array(t);e.enqueue(r),n.postMessage("chunk added")}else t instanceof Uint8Array?(e.enqueue(t),n.postMessage("chunk added")):"close"==t?e.close():"abort"==t&&e.abort()}},cancel:function(){console.log("aborted")}});downloads[t]={downloadUrl:t,fileInfo:o,messagePort:n,stream:r},n.postMessage(t)};